<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>CRM Dashboard</title>
  <style>
    body { font-family: Arial; background-color: #f4f4f4; padding: 30px; color: #333; }
    select, button { padding: 6px 12px; font-size: 16px; margin: 10px 5px; }
    iframe { width: 100%; height: 600px; border: 1px solid #ccc; border-radius: 6px; display: none; margin-top: 20px; }
    #message { margin-top: 20px; font-size: 16px; color: #555; }
    #spinner {
      border: 6px solid #eee;
      border-top: 6px solid #007bff;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      display: none;
      margin: 30px auto;
    }
    @keyframes spin { 100% { transform: rotate(360deg); } }
    .dark-mode { background-color: #121212; color: #eee; }
    .dark-mode select, .dark-mode button { background-color: #333; color: #fff; }
    .dark-mode iframe { background-color: #000; }
  </style>
</head>
<body>
  <h2>üìä CRM Dashboard</h2>

  <label>–°—Ç–∞–¥–∏—è:</label>
  <select id="stage">
    <option value="">-- –≤—ã–±–µ—Ä–∏—Ç–µ --</option>
    <option>–ù–î–ó</option>
    <option>–ù–î–ó 2</option>
    <option>–ü–µ—Ä–µ–∑–≤–æ–Ω–∏—Ç—å</option>
    <option>–ü—Ä–∏–≥–ª–∞—à–µ–Ω –∫ —Ä–µ–∫—Ä—É—Ç–µ—Ä—É</option>
  </select>

  <label>–ü–µ—Ä–∏–æ–¥:</label>
  <select id="range">
    <option value="">-- –≤—ã–±–µ—Ä–∏—Ç–µ --</option>
    <option value="today">–°–µ–≥–æ–¥–Ω—è</option>
    <option value="week">–ù–µ–¥–µ–ª—è</option>
    <option value="month">–ú–µ—Å—è—Ü</option>
  </select>

  <button onclick="loadReport()">üì• –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç—á—ë—Ç</button>
  <button onclick="toggleTheme()">üåô –¢–µ–º–∞</button>

  <div id="spinner"></div>
  <div id="message">üí° –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞–¥–∏—é –∏ –ø–µ—Ä–∏–æ–¥, –∑–∞—Ç–µ–º –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É.</div>
  <iframe id="reportFrame"></iframe>

  <script>
    function loadReport() {
      const stage = document.getElementById("stage").value;
      const range = document.getElementById("range").value;
      const iframe = document.getElementById("reportFrame");
      const spinner = document.getElementById("spinner");
      const msg = document.getElementById("message");

      if (!stage || !range) {
        msg.innerText = "‚ö†Ô∏è –£–∫–∞–∂–∏—Ç–µ –æ–±–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞: —Å—Ç–∞–¥–∏—é –∏ –ø–µ—Ä–∏–æ–¥.";
        iframe.style.display = "none";
        spinner.style.display = "none";
        return;
      }

      const url = `/daily?label=${encodeURIComponent(stage)}&range=${range}`;
      spinner.style.display = "block";
      iframe.style.display = "none";
      msg.innerText = `üîÑ –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Ç—á—ë—Ç: —Å—Ç–∞–¥–∏—è ‚Äî ${stage}, –ø–µ—Ä–∏–æ–¥ ‚Äî ${range}`;

      iframe.onload = function () {
        spinner.style.display = "none";
        iframe.style.display = "block";
        msg.innerText = `‚úÖ –û—Ç—á—ë—Ç –ø–æ —Å—Ç–∞–¥–∏–∏ "${stage}" –∑–∞ "${range}" –∑–∞–≥—Ä—É–∂–µ–Ω`;
      };

      iframe.src = url;
    }

    function toggleTheme() {
      document.body.classList.toggle("dark-mode");
    }
  </script>
</body>
</html>
