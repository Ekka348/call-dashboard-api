<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ª–∏–¥–æ–≤ Bitrix</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f0f0f0;
    }
    h1 {
      margin-bottom: 20px;
    }
    .block {
      background: #fff;
      padding: 15px 20px;
      border-radius: 8px;
      margin-bottom: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .stage-name {
      font-weight: bold;
    }
    ul {
      padding-left: 0;
      list-style: none;
    }
    li {
      margin-bottom: 6px;
    }
  </style>
  <script src="stages.js" defer></script>
</head>
<body>
  <h1>üìä –õ–∏–¥—ã –ø–æ —Å—Ç–∞–¥–∏—è–º Bitrix24</h1>

  <div class="block">
    <ul id="fixed_stage_list">
      <li>‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</li>
    </ul>
  </div>

  <footer style="color:#888;">
    <p>–ò—Å—Ç–æ—á–Ω–∏–∫: Bitrix24 —á–µ—Ä–µ–∑ –∑–∞–¥–∞–Ω–Ω—ã–π —Ö—É–∫. –°—Ç–∞–¥–∏–∏ ‚Äî –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ API.</p>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const stagesContainer = document.getElementById('fixed_stage_list');

      async function fetchStages() {
        try {
          const response = await fetch('/api/leads/stages');
          if (!response.ok) throw new Error(`–û—à–∏–±–∫–∞: ${response.status}`);

          const data = await response.json();
          renderStages(data.stages);
        } catch (error) {
          console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞–¥–∏–∏:', error);
          stagesContainer.innerHTML = '<li>‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞–¥–∏–π.</li>';
        }
      }

      function renderStages(stages) {
        stagesContainer.innerHTML = '';
        stages.forEach(stage => {
          const li = document.createElement('li');
          li.innerHTML = `<span class="stage-name">${stage.name}</span>: ${stage.count}`;
          stagesContainer.appendChild(li);
        });
      }

      fetchStages();
    });
  </script>
</body>
</html>

